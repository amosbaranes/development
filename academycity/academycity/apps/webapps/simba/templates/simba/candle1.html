{% load static %}
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Financial | Chart.js</title>
		<script src="https://cdn.jsdelivr.net/npm/luxon@1.26.0"></script>
		<script src="https://cdn.jsdelivr.net/npm/chart.js@3.0.1/dist/chart.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.0.0"></script>

		<script src="{% static 'js/chartjs/chartjs-chart-financial.js'  %}" type="text/javascript"></script>
		<link rel="stylesheet" type="text/css" href="style.css">
		<link rel="icon" href="{% static 'images/favicon.ico'  %}"/>
	</head>
	<body>
	<button>
    <a href="{% url 'simba:home' %}">Home</a>
</button>
		<h1>Chart.js - Financial chart</h1>
		<p>See the <a href="https://github.com/chartjs/chartjs-chart-financial/tree/master/docs">source for this example</a>, <a href="https://github.com/chartjs/chartjs-chart-financial">README</a>, and <a href="https://www.chartjs.org/docs/">Chart.js docs</a> for more details.</p>
		<h2>Sample Chart</h2>
		<div style="width:1000px">
			<canvas id="chart"></canvas>
		</div>

		<div>
			Bar Type:
			<select id="type">
				<option value="candlestick" selected>Candlestick</option>
				<option value="ohlc">OHLC</option>
			</select>
			Scale Type:
			<select id="scale-type">
				<option value="linear" selected>Linear</option>
				<option value="logarithmic">Logarithmic</option>
			</select>
			Color Scheme:
			<select id="color-scheme">
				<option value="muted" selected>Muted</option>
				<option value="neon">Neon</option>
			</select>
			Border:
			<select id="border">
				<option value="true" selected>Yes</option>
				<option value="false">No</option>
			</select>
			Mixed:
			<select id="mixed">
				<option value="true">Yes</option>
				<option value="false" selected>No</option>
			</select>
			<button id="update">Update</button>
			<button id="randomizeData">Randomize Data</button>
		</div>
		<script type="text/javascript">
			var barCount = 600;
			var initialDateStr = '01 Apr 2017 00:00 Z';

			var ctx = document.getElementById('chart').getContext('2d');
			ctx.canvas.width = 1000;
			ctx.canvas.height = 250;

			var barData = getRandomData(initialDateStr, barCount);
			function lineData() { return barData.map(d => { return { x: d.x, y: d.c} }) };

			var chart = new Chart(ctx, {
				type: 'candlestick',
				data: {
					datasets: [{
						label: 'CHRT - Chart.js Corporation',
						data: barData
					}]
				}
			});

			var getRandomInt = function(max) {
				return Math.floor(Math.random() * Math.floor(max));
			};

			function randomNumber(min, max) {
				return Math.random() * (max - min) + min;
			}

			function randomBar(date, lastClose) {
				var open = +randomNumber(lastClose * 0.95, lastClose * 1.05).toFixed(2);
				var close = +randomNumber(open * 0.95, open * 1.05).toFixed(2);
				var high = +randomNumber(Math.max(open, close), Math.max(open, close) * 1.1).toFixed(2);
				var low = +randomNumber(Math.min(open, close) * 0.9, Math.min(open, close)).toFixed(2);
				return {
					x: date.valueOf(),
					o: open,
					h: high,
					l: low,
					c: close
				};

			}

			function getRandomData(dateStr, count) {
				var date = luxon.DateTime.fromRFC2822(dateStr);
				var data = [randomBar(date, 30)];
				while (data.length < count) {
					date = date.plus({minutes: 1});
					if (date.weekday <= 5) {
						data.push(randomBar(date, data[data.length - 1].c));
					}
				}
				return data;
			}

			var update = function() {
				var dataset = chart.config.data.datasets[0];

				// candlestick vs ohlc
				var type = document.getElementById('type').value;
				dataset.type = type;

				// linear vs log
				var scaleType = document.getElementById('scale-type').value;
				chart.config.options.scales.y.type = scaleType;

				// color
				var colorScheme = document.getElementById('color-scheme').value;
				if (colorScheme === 'neon') {
					dataset.color = {
						up: '#01ff01',
						down: '#fe0000',
						unchanged: '#999',
					};
				} else {
					delete dataset.color;
				}

				// border
				var border = document.getElementById('border').value;
				var defaultOpts = Chart.defaults.elements[type];
				if (border === 'true') {
					dataset.borderColor = defaultOpts.borderColor;
				} else {
					dataset.borderColor = {
						up: defaultOpts.color.up,
						down: defaultOpts.color.down,
						unchanged: defaultOpts.color.up
					};
				}

				// mixed charts
				var mixed = document.getElementById('mixed').value;
				if(mixed === 'true') {
					chart.config.data.datasets = [
						{
							label: 'CHRT - Chart.js Corporation',
							data: barData
						},
						{
							label: 'Close price',
							type: 'line',
							data: lineData()
						}
					]
				}
				else {
					chart.config.data.datasets = [
						{
							label: 'CHRT - Chart.js Corporation',
							data: barData
						}
					]
				}

				chart.update();
			};

			document.getElementById('update').addEventListener('click', update);

			document.getElementById('randomizeData').addEventListener('click', function() {
				barData = getRandomData(initialDateStr, barCount);
				update();
			});
		</script>
	</body>
</html>

